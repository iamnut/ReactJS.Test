<html>
<head>

<meta charset="utf-8">
<title>ReactJS - Get Information from github</title>

<script src="js/react.min.js"></script>
<script src="js/JSXTransformer.js"></script>
<script src="js/jquery.min.js"></script>

<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/style.css">

<script type="text/jsx">

var MainUI = React.createClass({
	getInitialState: function(){
		return {
			username: 'facebook'
		};
	},

	handleClickOK: function(){
		this.setState({ 
			username: React.findDOMNode(this.refs.username).value.trim(),
		});
	},

	handleUserClickFollowerList: function(username){
		console.log('You clicked: ' + username);
		React.findDOMNode(this.refs.username).value = username;
		this.setState({ 
			username: username,
		});
	},

	render: function(){
		return 	<div>
					<div className="container input-area">
						<div className="row">
							<div className="col-md-10">
								<input type="text" id="githubUsername" className="form-control" ref="username"/>
							</div>
							<div id="input" className="col-md-2">
								<button onClick={this.handleClickOK} className={('btn btn-primary btn-block')}>OK</button>
							</div>
						</div>
					</div>
					<div className="container info-area">
						<Profile username={this.state.username}/>
						<div className="row">
							<FollowerList onUserClick={this.handleUserClickFollowerList} username={this.state.username}/>
							<RepositoryList username={this.state.username}/>
						</div>
					</div>
				</div>;
	}
});

var Profile = React.createClass({
	getInitialState: function(){
		return {
			infomation: {}
		};
	},

	loadProfile: function(){
		$.get('https://api.github.com/users/' + this.props.username, function(result) {
			if (this.isMounted()) {
				this.setState({
					infomation: result
				});
			}
		}.bind(this));
	},

	componentDidMount: function(){
		this.loadProfile();
	},

	componentWillUpdate: function(){
		this.loadProfile();
	},

	render: function(){
		return 	<div className="row">
					<div className="col-md-2">
						<img className="avatar" src={this.state.infomation.avatar_url}/>
					</div>
					<div className="col-md-10">
						<h3>{this.state.infomation.name}</h3>
						<strong>BIO:</strong>
						<p>{this.state.infomation.bio}</p>
					</div>
				</div>;
	}
});

var FollowerList = React.createClass({
	getInitialState: function(){
		return {
			followerList: []
		};
	},

	loadFollowerList: function(){
		$.get('https://api.github.com/users/' + this.props.username + '/followers', function(result) {
			if (this.isMounted()) {
				this.setState({
					followerList: result
				});
			}
		}.bind(this));
	},

	componentDidMount: function(){
		this.loadFollowerList();
	},

	componentWillUpdate: function(){
		this.loadFollowerList();
	},

	handleClick: function(username){
		this.props.onUserClick(username);
	},

	render: function(){
		return 	<div className="col-md-4 col-md-offset-2">
					<strong>Followers</strong>
					<ul className="followerList">
					{
						this.state.followerList.map(function(item){
						return 	<li>
									<img className="avatarFollower" src={item.avatar_url}/>
									<a href="#" onClick={this.handleClick.bind(this, item.login)}>{item.login}</a>
								</li>;
						}, this)
					}
					</ul>
				</div>;
	}
});

var RepositoryList = React.createClass({
	getInitialState: function(){
		return {
			repositoryList: []
		};
	},

	loadRepositoryList: function(){
		$.get('https://api.github.com/users/' + this.props.username + '/repos', function(result) {
			if (this.isMounted()) {
				this.setState({
					repositoryList: result
				});
			}
		}.bind(this));
	},

	componentDidMount: function(){
		this.loadRepositoryList();
	},

	componentWillUpdate: function(){
		this.loadRepositoryList();
	},

	render: function(){
		return	<div className="col-md-4">
					<strong>Repository</strong>
					<ul className="repositoryList">
					{
						this.state.repositoryList.map(function(item){
							return <li>{item.name}</li>;
						}, this)
					}
					</ul>
				</div>;
	}
});

React.render(<MainUI/>, document.body);
</script>

</head>
<body>

</body>
</html>